@page "/Reunion-Agenda"
@using Microsoft.AspNetCore.Authorization;
@using Microsoft.AspNetCore.Components.Authorization;
@inject AuthenticationStateProvider AuthenticationStateProvider
@attribute [Authorize(Roles = "SuperAdmin,AgendaReuniones")]

<nav class="navbar navbar-expand-lg justify-content-center"
     style="border-radius: 10px; background-color: #00bbb4">
    <h1 class="navbar-brand" href="#" style="color: black; font-weight: bold">
        Reservación de salas
    </h1>
</nav>

<div class="mb-3 mt-3">
    <div class="col-6">
        <MudSelect T="string" Label="Selecciona una sala de reunión"
                   Value="salaReunion.Nombre" ValueChanged="OnSalaReunionSeleccionadaChanged" AnchorOrigin="Origin.BottomCenter">
            @foreach (var salaReunion in ListSalaReunion)
            {
                <MudSelectItem Value="@salaReunion.Nombre" />
            }
        </MudSelect>
    </div>
</div>

@if (mostrarCalendario)
{
    <AuthorizeView Roles="SuperAdmin,AgregarAgendaReuniones" Context="context">
        <Authorized>
            <div class="mb-3">
            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" OnClick="@(() => NuevoModalReservacion())" Color="Color.Success" Class="ml-auto">+ reservación</MudButton>
            </div>
        </Authorized>
    </AuthorizeView>

        <AuthorizeView Roles="SuperAdmin,consultaAgendaReuniones" Context="context">
            <Authorized>
                <div id="calendar" class="w-100 h-50"> </div>
            </Authorized>
        </AuthorizeView>


<div class="modal justify-content-center align-items-center" id="eventoModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="tituloEvento"></h5>
                <button type="button" class="close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                        <p hidden="hidden" id="IdEvento"></p>
                    <div class="row">
                        <div class="col">
                            <strong> Creado por:</strong>
                        </div>
                        <div class="col" id="AutorEvento">
                        </div>
                    </div>
                        <div class="row">
                            <div class="col">
                                <strong> Fecha :</strong>
                            </div>
                            <div class="col" id="FechaEvento">
                            </div>
                        </div>
                    <div class="row">
                        <div class="col">
                           <strong> Hora inicio:</strong>
                        </div>
                        <div class="col" id="FechaInicioEvento">                          
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <strong> Hora fin:</strong>
                        </div>
                        <div class="col" id="FechaFinEvento">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <strong>Descripción:</strong>
                        </div>                       
                    </div>
                    <div class="row">
                        <div class="col">
                            <p id="descripcionEvento"></p>
                        </div>
                    </div>            
                </div>
            </div>

            <div class="modal-footer">
                <AuthorizeView Roles="SuperAdmin,EliminarAgendaReuniones" Context="context">
                    <Authorized>
                            <button type="button" @onclick="BtnMostrarModalEliminar" class="close btn btn-danger">Eliminar</button>
                    </Authorized>
                </AuthorizeView>
                <button type="button" class="close btn btn-secondary">Cerrar</button>
            </div>
        </div>              
    </div>
</div>
<div class="modal-backdrop show invisible" id="fondoModal"></div>
}

@if (mostrarModalEliminar)
{
    <div class="modal show  d-flex justify-content-center align-items-center" tabindex="-1" role="dialog" style="display: block;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Eliminación</h5>
                    <button type="button" class="close" @onclick="CerrarModalEliminar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de que deseas eliminar este registro @((MarkupString)RegistroEliminar) ?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CerrarModalEliminar">Cancelar</button>
                    <button type="button" class="btn btn-danger" @onclick="EliminarReservacion">Eliminar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop show"></div>
}

@if (mostrarModalNuevo)
{
    <div class="modal show" tabindex="-1" role="dialog" style="display: block;">
        <div class="modal-dialog modal-dialog-centered justify-content-center" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar</h5>
                    <button type="button" class="close" @onclick="CerrarModalNuevo">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <EditForm Model="@CreateReservacion" OnValidSubmit="OnValidSubmit">
                    <DataAnnotationsValidator />
                    <MudGrid>
                        <MudItem xs="12" sm="12">
                            <MudCard>
                                <MudCardContent>
                                    <MudTextField Label="Titulo" @bind-Value="CreateReservacion.title" For="@(() => CreateReservacion.title)" />
                                    <MudDatePicker Label="Fecha" @bind-Date="CreateReservacion.Fecha" />
                                    <ValidationMessage For="@(() => CreateReservacion.Fecha)" />
                                    <MudTimePicker Label="Desde" @bind-Time="CreateReservacion.start" AmPm="true" Color="Color.Success" />
                                    <ValidationMessage For="@(() => CreateReservacion.start)" />
                                    <MudTimePicker Label="Hasta" @bind-Time="CreateReservacion.end" AmPm="true" Color="Color.Secondary" />
                                    <ValidationMessage For="@(() => CreateReservacion.end)" />
                                    @if (!string.IsNullOrEmpty(validationError))
                                    {
                                        <MudAlert Severity="Severity.Error" Variant="Variant.Filled">@validationError</MudAlert>
                                    }
                                    <MudTextField Label="Descripción (Opcional)" @bind-Value="CreateReservacion.description" Lines="2" For="@(() => CreateReservacion.description)" />
                                </MudCardContent>
                                <MudCardActions>
                                    <MudButton ButtonType="ButtonType.Button" OnClick="CerrarModalNuevo" Variant="Variant.Filled" Color="Color.Error" Class="ml-auto">Cancelar</MudButton>
                                    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Success" Class="ml-auto">Guardar</MudButton>
                                </MudCardActions>
                            </MudCard>
                        </MudItem>
                    </MudGrid>
                </EditForm>
            </div>
        </div>
    </div>
    <div class="modal-backdrop show"></div>


}
